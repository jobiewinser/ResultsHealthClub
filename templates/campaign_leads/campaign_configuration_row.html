{%load static tz core_tags%}
<td>
    <div class="row">
        <div class="col p-0">
            {{campaign.name}}
        </div>
        <div class="col-md-auto p-0">
            {%if campaign.warnings %}
                <span class="help"
                data-bs-toggle="popover" 
                data-bs-trigger="hover" 
                data-bs-html="true" 
                data-bs-placement="top"
                data-bs-title="Warnings"
                data-bs-content="
                <ul>
                    {%for k,v in campaign.warnings.items%}
                    <li>{{v}}</li>
                    {%endfor%}
                </ul>
                ">
                    <i class="fa-solid fa-triangle-exclamation" style="color:orange"></i>
                </span>
            {%endif%}
        </div>
    </div>
</td>
<td
data-bs-toggle="popover" 
data-bs-trigger="hover" 
data-bs-html="true" 
data-bs-placement="top"
data-bs-title="What does this do?"
data-bs-content="
<p>
    You can assign your lead campaign to any site under your company here. The templates available to auto send will depend on which site the lead campaign belongs to.
</p>
{%if campaign.is_manual%}
<p>
    This is disabled as it was automatically created by Winser Systems for manually created leads.
</p>
{%endif%}
"> 
    {%include 'campaign_leads/htmx/campaign_configuration_select.html'%}
<button hidden 
hx-post="{% url 'set-campaign-site' campaign_pk=campaign.pk %}" 
hx-swap="outerHTML" hx-include="#site_pk_{{campaign.pk}}" 
id="submit_site_pk_{{campaign.pk}}"></button>
</td>
<td>
    <span hidden>{{campaign.product_cost|floatformat:2}}</span>   
    <input type="number" min="0.00" max="10000.00" step="0.01" value="{{campaign.product_cost|floatformat:2}}" name="product_cost"
        class="form-control"
        hx-post="{% url 'campaign-assign-product_cost' %}" hx-swap="innerHTML" 
        hx-trigger="change delay:0.5s"
        hx-indicator=".top-htmx-indicator" 
        hx-vals='{"campaign_pk": "{{campaign.pk}}"}'
        hx-target="#row_{{campaign.pk}}"/>
</td>
<td>
    <span hidden>{{campaign.color}}</span>   
    <input type="color" id="color_{{campaign.pk}}"  name="color" class="form-control" style="min-height: 38.5px"
        hx-post="{% url 'campaign-assign-color' %}" hx-swap="innerHTML" 
        hx-trigger="change"
        hx-indicator=".top-htmx-indicator" 
        hx-vals='{"campaign_pk": "{{campaign.pk}}"}'
        hx-target="#row_{{campaign.pk}}"
            value="#{{campaign.color|rgb_to_hex_tuple_tag}}">
</td>
<td>         
    <span hidden>{{campaign.campaign_category.name}}</span>           
    
</td>
<td >         
    <span hidden>{{campaign.whatsapp_business_account.pk}}</span>                   
    <span  
        data-bs-toggle="popover" 
        data-bs-trigger="hover" 
        data-bs-html="true" 
        data-bs-placement="top"
        data-bs-title="What does this do?"
        data-bs-content='
        <p>
            You can assign your a whatsapp account for this campaign, this will then allow you to choose templates for this campaign.
        </p>
        '>                  
        <select class="form-select" name="whatsapp_business_account_pk" id="whatsapp_business_account_pk_{{campaign.pk}}" 
            hx-post="{% url 'campaign-assign-whatsapp-business-account' %}" hx-swap="innerHTML" 
            hx-trigger="change"
            hx-indicator=".top-htmx-indicator" 
            hx-vals='{"campaign_pk": "{{campaign.pk}}"}'
            hx-target="#row_{{campaign.pk}}" >
            <option value="">ðŸš«</option>
            {%for whatsapp_business_account in campaign.site.whatsappbusinessaccount_set.all%}
            <option {%if campaign.whatsapp_business_account.pk == whatsapp_business_account.pk %}selected{%endif%} value="{{whatsapp_business_account.pk}}">{{whatsapp_business_account.whatsappnumber}}</option>
            {%endfor%}
        </select>
    </span> 
</td>
<td>
    {%if campaign.whatsapp_business_account%}
    <span id="choose_templates_button_wrapper_{{campaign.pk}}">
        {%include 'campaign_leads/htmx/choose_templates_button.html'%}
    </span>    
        {% comment %} <button type="button" class="btn btn-primary">
            Notifications <span class="badge text-bg-secondary">4</span>
          </button> {% endcomment %}
    {%endif%}
</td>
