{%load static tz core_tags user_permission_tags%}

<span id="payment_methods_wrapper">
  {%if refresh_on_close%}
    <script>
        $('#generic_modal').on('hidden.bs.modal', function (e) {
            $('#page_load_indicator').addClass('htmx-request')
            window.location.reload();
        })
    </script>
    {%endif%}
    <div class="card card-highlight">
        <div class="card-body" style="min-width:1100px">
            <div class="alert alert-warning p-2">
                Below are some quick integrations you can add to your site. You can also change them from the Site Configuration page.
            </div>
            <div class="accordion">
              <div class="accordion-item">
                <h2 class="accordion-header" id="headingCalendly">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseCalendly" aria-expanded="true" aria-controls="collapseCalendly">
                    <i class="fa-regular fa-calendar-days pe-2"></i> Calendly
                  </button>
                </h2>
                <div id="collapseCalendly" class="accordion-collapse collapse" aria-labelledby="headingCalendly">
                  <div class="accordion-body">
                    {%include 'core/htmx/calendly_site_settings.html'%}
                  </div>
                </div>
              </div>


              <div class="accordion-item">
                <h2 class="accordion-header" id="headingWhatsapp">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseWhatsapp" aria-expanded="false" aria-controls="collapseWhatsapp">
                    <i class="fa fa-whatsapp pe-2"></i> Whatsapp <i class="fa-solid fa-rectangle-pro"></i>
                  </button>
                </h2>
                <div id="collapseWhatsapp" class="accordion-collapse collapse" aria-labelledby="headingWhatsapp">
                  <div class="accordion-body">
                    {%if site.subscription.whatsapp_enabled %} 
                    
                      {%if whatsapp_business_details.id%}
                      <div class="m-3">
                          {%include 'core/site_configuration/site_configuration_table_htmx.html'%}
                      </div>
                      {%else%}
                      To add a whatsapp number for this site, you need to add a valid Whatsapp configuration here: <a class="nowrap" type="button" 
                        hx-indicator="#page_load_indicator" hx-target="#generic_modal_body"
                        hx-vals='{"template_name": "company_quick_settings", "company_pk": "{{company.pk}}", "quick_settings_site": "{{site.pk}}"}'
                        hx-get="{% url 'get-modal-content' %}" hx-push-url="false"
                        hx-swap="innerHTML" hx-trigger="click"><i class="fa-light fa-gear"></i> Company Quick Settings</a>
                      {%endif%}
                    {%else%}
                    <div class="alert alert-info">
                      <p>With a <i class="fa-solid fa-rectangle-pro"></i> subscription, you can automate further by automatically sending <i class="fa fa-whatsapp text-success" aria-hidden="true"></i> Whatsapp templates to your customers immediately after they fill in your Active Campaign Forms.</p>
                      <p>You can also manage multiple whatsapp phone numbers from one screen, here on Winser Systems.</p>
                      {%for subscription_option in subscription_options%}
                      {%if not subscription_option == site.subscription and subscription_option.whatsapp_enabled%}
                          <button class="btn btn-sm btn-{{subscription_option.bootstrap_colour}}"
                              hx-indicator=".top-htmx-indicator" hx-target="#generic_modal_body" 
                              hx-vals='{"template_name": "switch_subscription","switch_subscription":"{{subscription_option.numerical}}","site_pk":"{{site.pk}}"}'
                              hx-get="{% url 'campaign-lead-get-modal-content'%}" 
                              hx-push-url="false"
                              hx-swap="innerHTML" hx-trigger="click">
                              Switch to <b>{{subscription_option.get_name_display}}</b> subscription Â£{{subscription_option.cost|floatformat:2}} p/m (for this site)
                          </button>
                      {%endif%}
                      {%endfor%}
                    </div>
                    {%endif%}  
                  </div>
                </div>
              </div>
            </div>      
        </div>                
    </div>
</span>
<span hx-swap-oob="true" id="generic_modal_title">
    Quick Settings for {{site.name}}
</span>