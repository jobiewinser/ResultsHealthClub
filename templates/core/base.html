{%load static core_tags%}
<!DOCTYPE html>
<meta name="viewport" content="width=device-width, initial-scale=1">
<html>
    <head>
        {%block cdn%}
            <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet" />

            <script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>                    
            <script src="{% static 'js/jquery-3.6.0.js' %}"></script>                    
            <script src="{% static 'js/popper.min.js' %}"></script>                    
            <script src="{% static 'js/fontawesome.js' %}"></script>  
            <script src="{% static 'js/htmx.min.js' %}"></script>  
            <script src="{% static 'js/palette.js' %}"></script>        
            <link href="{% static 'css/snackbar.css' %}" rel="stylesheet" />
            <script src="{% static 'js/snackbar.js' %}"></script> 
            
            <link rel="stylesheet" type="text/css"  href="{% static 'css/side_bar.css' %}">
            <link rel="stylesheet" type="text/css"  href="{% static 'css/base.css' %}">
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.0/font/bootstrap-icons.css" />
           {%endblock cdn%}

        {%block scripts%}
        <script>
            
            function fallbackCopyTextToClipboard(text) {
                var textArea = document.createElement("textarea");
                textArea.value = text;
                
                // Avoid scrolling to bottom
                textArea.style.top = "0";
                textArea.style.left = "0";
                textArea.style.position = "fixed";
              
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
              
                try {
                  var successful = document.execCommand('copy');
                  var msg = successful ? 'successful' : 'unsuccessful';
                  if (msg == 'successful') {
                    snackbarShow('Successfully copied free taster link', 'success')
                  } else {
                    snackbarShow('Failed to copy free taster link', 'danger')
                  }
                } catch (err) {
                }
              
                document.body.removeChild(textArea);
              }

              function inlinePreventDefault(e) {
                  e.preventDefault();
              }
              
              function copyTextToClipboard(text) {
                if (!navigator.clipboard) {
                  fallbackCopyTextToClipboard(text);
                  return;
                }
                navigator.clipboard.writeText(text).then(function() {
                    snackbarShow('Successfully copied free taster link', 'success')
                }, function(err) {
                    snackbarShow('Failed to copy free taster link', 'danger')
                });
              }
            </script>
            
            <script>
                let dt = null;
                $(document).ready(function() {    
                    $("[data-bs-toggle=popover]").popover();
                    document.body.addEventListener('htmx:afterSwap', function(evt) {  
                        if (evt.detail.target.id == 'generic_modal_body'){
                            $('#generic_modal').modal('show');
                        }
                        if (![undefined, ''].includes(evt.detail.pathInfo.path)){
                            console.log(evt.detail.pathInfo.path)
                            if (evt.detail.pathInfo.path.includes("modify-user")){
                                $('#generic_modal').modal('hide');
                                snackbarShow('Successfully modifed/added user', 'success')
                            }
                        }
                        if (evt.detail.xhr.status == 200){
                        } else {
                            snackbarShow(evt.detail.xhr.responseText, 'danger')
                        }
                        $('.popover').remove()
                        $('[data-bs-toggle=popover]').popover();
                    });     
                    
                    document.body.addEventListener('htmx:afterRequest', function(evt) {  
                        let status = evt.detail.xhr.status;
                        let srcElement = $(evt.srcElement);
                        let src_id = srcElement.attr('id');
                        if(status == 200) {
                            if (![undefined, ''].includes(evt.detail.pathInfo.path)){
                                if (evt.detail.pathInfo.path.includes("login")){
                                    window.location.replace("/");
                                }
                            }
                        } else if (status == 404) {
                            if ($('#'+src_id+"_error").length == 0){                                
                                $("#"+src_id).after("<div id='"+src_id+"_error' style='color:red'>Not Found</div>");
                            } else {                                
                                $('#'+src_id+"_error").html("<div id='"+src_id+"_error' style='color:red'>Not Found</div>");
                            }
                        }else if (status == 500){
                            snackbarShow('Error: '+evt.detail.xhr.response, 'danger')           
                        }
                    });                    
                    

                    document.body.addEventListener('htmx:configRequest', function(evt) {    
                        evt.detail.headers['x-csrftoken'] = $('#csrf_token').val();
                    });
                });
            </script>
        {%endblock scripts%}

        {%block styles%}
        <style>
              
        </style>
        {%endblock styles%}
        
    </head>

    <body>
        <div class="container-fluid overflow-hidden p-0">
            <div class="row vh-100 overflow-auto">
                <div class="col-12 col-sm-3 col-xl-2 px-sm-2 px-0 bg-dark d-flex sticky-top">
                    <div class="d-flex flex-sm-column flex-row flex-grow-1 align-items-center align-items-sm-start px-3 pt-2 text-white">
                    <a href="/" class="d-flex align-items-center pb-sm-3 mb-md-0 me-md-auto text-white text-decoration-none">
                            {% comment %} <span class="fs-5">B<span class="d-none d-sm-inline">rand</span></span>                             {% endcomment %}
                            <span class="fs-5"><a class="navbar-brand" href="{%url 'home'%}"><img class="side_nav_logo" src="{% static 'img/logo_white.png' %}" alt="winser systems logo"></a></span>

                        </a>
                        <div id="pb" class="progress-bar top-htmx-indicator" style="width:100%"></div>
                        <ul class="nav nav-pills flex-sm-column flex-row flex-nowrap flex-shrink-1 flex-sm-grow-0 flex-grow-1 mb-sm-auto mb-0 justify-content-center align-items-center align-items-sm-start" id="menu">
                            {%if request.user.is_authenticated%} 
                            <li class="nav-item">
                                <a href="{%url 'customer-home'%}" class="nav-link px-sm-0 px-2">
                                    <i class="fs-5 bi-house"></i><span class="ms-1 d-none d-sm-inline">Customer Home</span>
                                </a>
                            </li>
                            {%else%}
                            <li class="nav-item">
                                <a href="{%url 'home'%}" class="nav-link px-sm-0 px-2">
                                    <i class="fs-5 bi-house"></i><span class="ms-1 d-none d-sm-inline">Home</span>
                                </a>
                            </li>
                            {%endif%}

                            
                            {% comment %} {%if request.user.is_authenticated%} 
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle px-sm-0 px-1" style="{%if 'campaign-leads/' in request.path%} font-weight:bold{%endif%}" id="dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="fs-5 bi-bootstrap"></i><span class="ms-1 d-none d-sm-inline">My Products </span>
                                </a>
                                <ul class="dropdown-menu dropdown-menu-dark text-small shadow" aria-labelledby="dropdown">
                                    {%if request.user.profile.get_company.campaign_leads_enabled%} 
                                    <a href="{% url 'customer-home'%}" class="dropdown-item"  style="{%if 'campaign-leads/' in request.path%} font-weight:bold{%endif%}">My Campaign Leads</a>
                                    {%endif%}
                                    {%if request.user.profile.get_company.free_taster_enabled%} 
                                    <a href="{% url 'free-taster-overview'%}" class="dropdown-item"  style="{%if 'free-taster/' in request.path%} font-weight:bold{%endif%}">My Free Taster Links</a>
                                    {%endif%}
                                </ul>
                            </li>
                            {%endif%} {% endcomment %}
                            
                            {% comment %} <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle px-sm-0 px-1" id="dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="fs-5 bi-bootstrap"></i><span class="ms-1 d-none d-sm-inline">All Products</span>
                                </a>
                                <ul class="dropdown-menu dropdown-menu-dark text-small shadow" aria-labelledby="dropdown">
                                    <a href="{% url 'campaign-leads-product-page'%}" class="dropdown-item" style="{%if 'campaign-leads-product-page/' in request.path%} font-weight:bold{%endif%}">Campaign Leads</a>
                                </ul>
                            </li>
                            <br> {% endcomment %}
                            <li class="dropdown">
                                <a href="https://portfolio.jobiewinser.co.uk/leads-management-privacy-policy/" class="nav-link px-sm-0 px-1">
                                    <i class="fa-solid fa-circle-info"></i><span class="ms-1 d-none d-sm-inline">Privacy Policy</span>
                                </a>
                            </li>
                            <li class="dropdown">
                                <a href="/admin" class="nav-link px-sm-0 px-1">
                                    <i class="fa-solid fa-circle-info"></i><span class="ms-1 d-none d-sm-inline">Admin Panel</span>
                                </a>
                            </li>

                            
                        </ul>
                        <div id="profile-nav-section" style="width:100%" class="p-2">
                        {%include 'core/htmx/profile-nav-section.html'%}
                        </div>
                    </div>
                </div>
                {%block overide_content%}    
                <div class="col d-flex flex-column h-sm-100 p-0" style="overflow-x:hidden"> 
                    <main class="row  p-0 mt-2"">
                        {%block content%} 
                        {%endblock content%}
                    </main>
                </div>
                {%endblock overide_content%}
            </div>
        </div>

        <div class="modal fade" id="generic_modal" role="dialog" style="overflow:hidden;display: none;">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="generic_modal_title"></h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true"></span>
                        </button>
                    </div> 
                    <div class="modal-body" id="generic_modal_body">
                    </div>
                </div>
            </div>
        </div>
        {%block snackbar%}
        <div id="snackbar"></div>
        {%endblock snackbar%}
        
    </body>
</html>

