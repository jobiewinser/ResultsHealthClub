{%load static%}
<td>
    
    <div class="row">
        <div class="col p-0">
            <img src="{%if profile.avatar%}/media/{{profile.avatar}}{%else%}{% static 'img/blank-profile-picture.png' %}{%endif%}" alt="" width="45" height="45" class="rounded-circle m-1"> 
            {{profile.name}}
        </div>
        <div class="col-md-auto p-0" >
            {%if profile.warnings %}
                <span 
                data-bs-toggle="popover" 
                data-bs-trigger="hover" 
                data-bs-html="true" 
                data-bs-placement="top"
                data-bs-title="Warnings"
                data-bs-content="
                <ul>
                    {%for k,v in profile.warnings.items%}
                    <li>{{v}}</li>
                    {%endfor%}
                </ul>
                ">
                    <i class="fa-solid fa-triangle-exclamation" style="color:orange; margin-top:12px; margin-left:6px;"></i>
                </span>
            {%endif%}
        </div>
    </div>
</td>
<td>
    <div class="row">
        <div class="col p-0">
            <select class="form-select reset_on_error" name="site_pk" id="profile_site_{{profile.pk}}" hx-post="{% url 'change-profile-site' %}" hx-swap="innerHTML" 
            data-value="" onfocus="this.setAttribute('data-value', this.value);"
            hx-indicator="#htmx_indicator_site_{{profile.pk}}"  hx-trigger="change" hx-target="#company_configuration_row_{{profile.pk}}"
            hx-vals='{"profile_pk": "{{profile.pk}}"}'>  
                {%if not profile.site%}<option value="" selected>None</option>{%endif%}
                {%for site in profile.company.site_set.all%}
                    <option value="{{site.pk}}" {%if profile.site == site%}selected{%endif%}>{{site.name}}</option>
                {%endfor%}
            </select>
        </div>
        <div class="col-md-auto pe-0">
            <img  class="htmx-indicator invert" id="htmx_indicator_site_{{profile.pk}}" src="https://htmx.org/img/bars.svg"/>
        </div>
    </div>
</td>
<td>
    <div class="row">
        <div class="col p-0">
            <select class="form-select reset_on_error" name="role" id="profile_role_{{profile.pk}}" hx-post="{% url 'change-profile-role' %}" hx-swap="innerHTML" {%if profile.role == 'a'%}disabled{%endif%} 
            data-value="" onfocus="this.setAttribute('data-value', this.value);"
            hx-indicator="#htmx_indicator_role_{{profile.pk}}"  hx-trigger="change" hx-target="#company_configuration_row_{{profile.pk}}"
            hx-vals='{"profile_pk": "{{profile.pk}}"}'>  
                {%if profile.role == 'a'%}
                <option selected>Owner</option>
                {%else%}
                {%for role_choice in role_choices%}
                    {%if not role_choice.0 == 'a'%}
                        <option {%if profile.role == role_choice.0%}selected{%endif%} value="{{role_choice.0}}">{{role_choice.1}}</option>
                    {%endif%}
                {%endfor%}
                {%endif%}
            </select>
        </div>
        <div class="col-md-auto pe-0">
            <img  class="htmx-indicator invert" id="htmx_indicator_role_{{profile.pk}}" src="https://htmx.org/img/bars.svg"/>
        </div>
    </div>
</td>
<td>   
    {%if not profile.role == 'a' or profile == request.user.profile%}
        <a class="nowrap btn btn-light pointer" type="button" 
            hx-indicator=".top-htmx-indicator" hx-target="#generic_modal_body"
            hx-vals='{"template_name": "edit_user", "user_pk": "{{profile.user.pk}}"}'
            hx-get="{% url 'get-modal-content' %}" hx-push-url="false"
            hx-swap="innerHTML" hx-trigger="click"><i class="fa-light fa-gear"></i> Config</a>
    {%endif%}
    {%if not profile.role == 'a'%}
    <a class="nowrap btn btn-light pointer" type="button"
        hx-indicator=".top-htmx-indicator" hx-target="#generic_modal_body"
        hx-vals='{"template_name": "edit_permissions", "profile_pk": "{{profile.pk}}"}'
        hx-get="{% url 'get-modal-content' %}" hx-push-url="false"
        hx-swap="innerHTML" hx-trigger="click"><i class="fa-light fa-ballot-check"></i> Edit Permissions</a>
    {%endif%}
</td>