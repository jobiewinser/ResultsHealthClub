{%load core_tags%}
{%load static tz core_tags%}

<span>    
    <script>
        $(document).ready(function() {
            document.title = "Company Configuration";
        });
    </script>
    
    <div class="row mt-0">
        {%block extra_top_left_buttons %}
        <div class="col-md-auto">
            {% comment %} <a class="btn btn-secondary" href="{%url 'customer-home'%}"><i class="fa-solid fa-arrow-left"></i> Back to Home</a>              {% endcomment %}
        </div>
        {%endblock extra_top_left_buttons %}
        <div class="col">
        </div>
        {%block extra_top_right_buttons %}
        <input id="current_page" hidden value="company_configuration"></input>
        <div class="col-md-auto">
            <span class="badge bg-dark text-white"><h6 class="m-1">Company Configuration</h6></span>           
        </div>
        {%endblock extra_top_right_buttons %}
    </div>
    <div class="row mt-2">
        <div class="col">
        </div>
        <div class="col-md-auto">
            <button class="nowrap btn btn-success btn-sm pointer" type="button" {%if request.user.profile.role == 'c'%}disabled{%endif%}
                hx-indicator=".top-htmx-indicator" hx-target="#generic_modal_body"
                hx-vals='{"template_name": "add_user"}'
                hx-get="{% url 'get-modal-content' %}" hx-push-url="false"
                hx-swap="innerHTML" hx-trigger="click"><i class="fa-light fa-plus"></i> Add User to {{company.name}}</button>
        </div>
        <div class="col-md-auto">
            <span
                title="Existing Sites"
                data-bs-toggle="popover" 
                data-bs-trigger="hover focus" 
                data-bs-placement="right"
                data-bs-html="true"
                data-bs-content="
                    <ul>
                        {%for site in company.site_set.all%}
                        <li>{{site.name}}</li>
                        {%endfor%}
                    </ul>
                    <br>
                    <b> To add another site to your company please contact Winser Systems!</b>
                ">
                <button class="nowrap btn btn-success btn-sm pointer" type="button" {%if request.user.profile.role == 'c'%}disabled{%endif%}
                    {%if not company.subscription == 'pro'%}disabled{%endif%}
                    disabled
                    hx-confirm="Are you sure you want to add another site?" 
                    hx-indicator=".top-htmx-indicator" 
                    hx-vals='{"company_pk": "{{company.pk}}"}'
                    hx-post="{% url 'add-site' %}" hx-push-url="true"
                    hx-swap="none" hx-trigger="click"><i class="fa-solid fa-circle-info help"></i> Add Another Site {%if not company.subscription == 'pro'%}<i class="fa-solid fa-rectangle-pro"></i>{%endif%}</button> 
            </span>
        </div>
        <div class="col">
        </div>
    </div>
    <div class="row mt-2">
        <div class="col">
        </div>
        <div class="col-md-auto card card-white p-2">
            <table class="table">
                <thead>
                    <tr>
                        <th class="center">
                            User
                        </th>
                        <th class="center">
                            Main Site
                        </th>
                        <th class="center">
                            Role
                        </th>
                        <th class="center">
                            Default Campaign Category
                        </th>
                        <th class="center">
                            Permissions
                        </th>
                        <th class="center">
                            Configuration
                        </th>
                    </tr>
                </thead>
                <tbody>
                    {%for temp_user in company.users%}
                    {%with temp_user.profile as profile%}
                    <tr id="company_configuration_row_{{profile.pk}}">
                        {%include 'core/htmx/company_configuration_row.html'%}
                    </tr>
                    {%endwith%}
                    {%endfor%}
                </tbody>
            </table>
        </div>
        <div class="col">
        </div>
    </div>
<span>
    
