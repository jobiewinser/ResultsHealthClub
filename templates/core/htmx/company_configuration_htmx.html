{%load core_tags%}
{%load static tz core_tags%}

<span>    
    <script>
        $(document).ready(function() {
            document.title = "Company Config";
            document.body.addEventListener('htmx:afterRequest', function(evt) {  
                if (evt.detail.xhr.status == 500){
                    $('.reset_on_error').each(function() {
                        if (![undefined, ''].includes((this).data('value'))){
                            $(this).data('value')
                            $(this).val($(this).data('value'));
                        }
                    });
                };
                
            });
            document.body.addEventListener('htmx:afterSwap', function(evt) {              
            });
        });
    </script>
    
    <div class="row mt-0">
        {%block extra_top_left_buttons %}
        <div class="col-md-auto">
            {% comment %} <a class="btn btn-secondary" href="{%url 'customer-home'%}"><i class="fa-solid fa-arrow-left"></i> Back to Home</a>              {% endcomment %}
        </div>
        {%endblock extra_top_left_buttons %}
        <div class="col">
        </div>
        {%block extra_top_right_buttons %}
        <div class="col-md-auto">
        <span class="badge bg-dark text-white"><h6 class="m-1">Company Configuration</h6></span>           
        </div>
        {%endblock extra_top_right_buttons %}
    </div>
    <div class="row mt-2">
        <div class="col">
        </div>
        <div class="col-md-auto">
            <a class="nowrap btn btn-success btn-sm pointer" type="button" 
                hx-indicator=".top-htmx-indicator" hx-target="#generic_modal_body"
                hx-vals='{"template_name": "add_user"}'
                hx-get="{% url 'get-modal-content' %}" hx-push-url="false"
                hx-swap="innerHTML" hx-trigger="click"><i class="fa-light fa-plus"></i> Add User to {{request.user.profile.company.company_name}}</a>
        </div>
        <div class="col">
        </div>
    </div>
    <div class="row mt-2">
        <div class="col">
        </div>
        <div class="col-md-auto card p-2">
            <table class="table">
                <thead>
                    <tr>
                        <th>
                            User
                        </th>
                        <th>
                            Main Site
                        </th>
                        <th>
                            Role
                        </th>
                        <th>
                            
                        </th>
                        <th>
                            
                        </th>
                    </tr>
                </thead>
                <tbody>
                    {%for temp_user in request.user.profile.company.users%}
                    {%with temp_user.profile as profile%}
                    <tr id="company_configuration_row_{{profile.pk}}">
                        {%include 'core/htmx/company_configuration_row.html'%}
                    </tr>
                    {%endwith%}
                    {%endfor%}
                </tbody>
            </table>
        </div>
        <div class="col">
        </div>
    </div>
<span>
    
