{%load core_tags%}
{%load static tz core_tags%}

<table id="overview_table" class="table"> 
    <thead> 
        <tr>
            <th>
                Phone Number ID
            </th>
            <th>
                Business Account
            </th>
            <th>
                Alias
            </th>
            <th>
                Number
            </th>
            <th>
                Site
            </th>
            <th>
                Company
            </th>
            <th>
                Name on Whatsapp
            </th>
            <th>
                Quality Rating
            </th>
            <th>
                Verified?
            </th>
            <th>
                Default?
            </th>
            <th>
                
                
            </th>
        </tr>
    </thead>
    <tbody> 
        {%for number in whatsapp_numbers%}
        <tr id="whatsappnumber_row_{{number.pk}}">
            <td>
                {{number.whatsapp_business_phone_number_id}}
            </td>
            <td>
                {{number.whatsapp_business_account.whatsapp_business_account_id}}
            </td>
            <td >
                <div class="row">
                    <div class="col p-0">
                        <input class="form-control form-control-sm" value="{%if number.alias%}{{number.alias}}{%endif%}" name="alias" id="alias_change_{{number.pk}}" hx-post="{% url 'whatsapp-change-number-alias' %}" hx-swap="none" {%if not request.user.profile.role == 'a'%}disabled{%endif%} 
                            hx-include="#alias_change_{{number.pk}}" hx-indicator="#htmx_indicator_alias_{{number.pk}}"  hx-trigger="input"
                            hx-vals='{"whatsappnumber_pk": "{{number.pk}}"}'/>
                    </div>
                    <div class="col-md-auto pe-0">
                        <img  class="htmx-indicator invert" id="htmx_indicator_alias_{{number.pk}}" src="https://htmx.org/img/bars.svg"/>
                    </div>
                </div>
            </td>
            <td>
                {{number.number}}
            </td>
            <td>
                <span class="name_display_{{site.pk}}">
                {{number.site.name}}
                </span>
            </td>
            <td>
                {{number.company.company_name}}
            </td>
            <td>
                {{number.verified_name}}
            </td>
            <td>
                {{number.quality_rating}}
            </td>
            <td>
                {{number.code_verification_status}}
            </td>
            <td>
                <input type="checkbox" class="form-check-input" name="default_number" {%if site.default_number == number %}checked{%endif%} {%if site.default_number == number or not request.user.profile.role == 'a'%}disabled{%endif%}
                    hx-post="{% url 'whatsapp-number-make-default' %}" hx-swap="innerHTML" 
                    hx-include="this" hx-indicator="#htmx_indicator_default_number_{{number.pk}}" 
                    hx-vals='{"whatsappnumber_pk": "{{number.pk}}"}' hx-target="#overview_table">
                <img  class="htmx-indicator invert" id="htmx_indicator_default_number_{{number.pk}}" src="https://htmx.org/img/bars.svg"/>
            </td>
            <td>        
                {% comment %} {%with number.company_sites_with_same_whatsapp_business_details as company_sites_with_same_whatsapp_business_details%}                        
                <span
                    data-bs-toggle="popover" 
                    data-bs-trigger="hover" 
                    data-bs-html="true" 
                    data-bs-placement="top"
                    data-bs-title="What does this do?"
                    data-bs-content="
                    <p>
                        This button allows you to transfer this number to another site under the same company, as long as they share the same whatsapp business account.
                    </p>
                    {%if not company_sites_with_same_whatsapp_business_details%}
                        <p>
                            This button is disabled because you do not have another site linked to your whatsapp business account.
                        </p>
                    {%endif%}
                    ">
                    <button class="btn btn-primary btn-sm m-1"   {%if not request.user.profile.role == 'a'%}disabled{%endif%}
                        {%if not company_sites_with_same_whatsapp_business_details%}disabled{%endif%}
                        hx-indicator=".top-htmx-indicator" hx-target="#generic_modal_body" 
                        hx-vals='{"template_name": "transfer_number", "whatsappnumber_pk": "{{number.pk}}"}'
                        hx-get="{% url 'campaign-lead-get-modal-content' %}" 
                        hx-push-url="false"
                        hx-swap="innerHTML" hx-trigger="click" id="transfer_number_{{template.pk}}"> 
                            <i class="fa fa-arrow-right" aria-hidden="true"></i> Transfer
                    </button>
                </span>
                {%endwith%} {% endcomment %}
            </td>
        </tr>
        {%endfor%}
    </tbody>
</table>