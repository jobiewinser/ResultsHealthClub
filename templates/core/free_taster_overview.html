{% extends 'core/base.html' %}
{%load static tz core_tags%}

{%block scripts%}
{{block.super}}
<link href="{% static 'css/datatables.css' %}" rel="stylesheet" />
<script src="{% static 'js/datatables.js' %}"></script> 
<script>
    $(document).ready(function() {
        initDataTable();
        document.body.addEventListener('htmx:beforeRequest', function(evt) {  
            if (![undefined, ''].includes(evt.detail.pathInfo.path) && ![undefined, ''].includes(evt.detail.target.id)){
                if (evt.detail.target.id == 'overview_table' || evt.detail.pathInfo.path.includes("academy-booking-overview")){
                    $("#overview_table").dataTable().fnDestroy();
                }
            }
        });
        document.body.addEventListener('htmx:afterSwap', function(evt) {  
            if (evt.detail.target.id == 'overview_table'){
                initDataTable(); 
            }
                        
            {% comment %} if (evt.detail.target.classList.contains('academy_booking_row')) {
                $('#refresh_overview_table').click(); 
            } {% endcomment %}
            
        });
    });
    function initDataTable() {
        dt = $('#overview_table').DataTable(
        );
    }
</script>
{%endblock scripts%}

{%block overide_content%}       
<div class="col d-flex flex-column h-sm-100 p-0" style="overflow-x:hidden"> 
    <main class="row">
        <div class="row m-3">
            {%block extra_top_left_buttons %}
            {%include 'core/htmx/site_selection.html'%}
            <button hidden hx-get="{% url 'free-taster-overview' %}" hx-push-url="true" hx-swap="outerHTML" hx-include=".non_site_dependant_overview_table_filters" hx-indicator=".top-htmx-indicator" hx-target="#overview_table" id="change_site" class="btn btn-primary btn-sm"></button>
            {%endblock%}
            <div class="col">                
            </div>
            {%block extra_top_right_buttons %}
                <div class="col-md-auto">
                    <button class="btn btn-success"
                        data-bs-toggle="popover" 
                        data-bs-trigger="hover" 
                        data-bs-placement="top"
                        data-bs-content="Generate a unique free taster link."
                        hx-indicator=".top-htmx-indicator" hx-target="#generic_modal_body" 
                        hx-vals='{"template_name": "create_free_taster_link"}'
                        hx-get="{% url 'get-modal-content' %}" 
                        hx-push-url="false"
                        hx-swap="innerHTML" hx-trigger="click">
                            <i class="fa-solid fa-link" aria-hidden="true"></i> Generate Free Taster Link
                    </button>
                    <input type="text" style="display:None" id="create_free_taster_link" name="template_name" value="create_free_taster_link"/>
                </div>
            {%endblock%}
        </div>
        <div class="row p-0 m-3">
            {%include 'core/htmx/free_taster_table_htmx.html'%}
        </div>
    </main>
</div>
{%endblock overide_content%}